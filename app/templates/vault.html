{% extends "base.html" %}
{% block content %}

<section class="card">
  <div class="vault-head">
    <div>
      <h2>Your Vault</h2>
      {% if selected_mood %}
        <div class="muted small">{{ selected_mood }}</div>
      {% endif %}
    </div>
    <div class="vault-head-actions">
      <a class="btn tiny ghost" href="{{ url_for('main.search') }}">Add a song</a>
      {% if selected_mood or query %}
        <a class="btn tiny ghost" href="{{ url_for('main.vault') }}">Reset view</a>
      {% endif %}
    </div>
  </div>

  <form class="vault-search" method="GET" action="{{ url_for('main.vault') }}">
    {% if selected_mood %}
      <input type="hidden" name="mood" value="{{ selected_mood }}">
    {% endif %}
    <input type="text" name="q" placeholder="Find something you saved" value="{{ query or '' }}">
    <button class="btn tiny primary" type="submit">Search</button>
  </form>

  <div class="mood-filter">
    <a class="pill {% if not selected_mood %}active{% endif %}" href="{{ url_for('main.vault', q=query) }}">All</a>
    {% for m in moods %}
      <a class="pill {% if selected_mood == m %}active{% endif %}" href="{{ url_for('main.vault', mood=m, q=query) }}">{{ m }}</a>
    {% endfor %}
  </div>
</section>

<section class="mood-groups">
  {% if selected_mood %}
    {% set list_for = grouped.get(selected_mood, []) %}
    <div class="mood-block">
      <div class="mood-block-head">
        <h3 class="mood-title">{{ selected_mood }} <span class="count-badge">{{ list_for|length }}</span></h3>
      </div>

      {% if list_for|length == 0 %}
        <div class="ghost-row small">
          <div class="ghost-art"></div>
          <div class="ghost-lines">
            <div class="ghost-line wide"></div>
            <div class="ghost-line"></div>
          </div>
        </div>
      {% else %}
        <ul class="song-list">
          {% for s in list_for %}
            <li class="song-item {% if highlight_id and highlight_id|int == s.id %}highlight{% endif %}"
                data-preview-url="{{ s.preview_url or '' }}">
              <div class="song-left">
                {% if s.artwork_url %}
                  <img class="song-art" src="{{ s.artwork_url }}" alt="Artwork">
                {% else %}
                  <div class="art-placeholder tiny"></div>
                {% endif %}
              </div>
              <div class="song-center">
                <div class="song-title">{{ s.title }}</div>
                {% if s.artist %}
                  <div class="song-artist">{{ s.artist }}</div>
                {% endif %}
                {% if s.note %}
                  <div class="song-note">{{ s.note }}</div>
                {% endif %}
              </div>
              <div class="song-right">
                {% if s.preview_url %}
                  <button class="btn tiny" type="button" data-audio-toggle>Play</button>
                {% endif %}
                <form class="inline-form" method="POST" action="{{ url_for('main.delete_song', song_id=s.id) }}">
                  <input type="hidden" name="next" value="{{ request.full_path }}">
                  <button class="btn tiny ghost danger" type="submit">Remove</button>
                </form>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  {% else %}
    {% for mood in moods %}
      {% set list_for = grouped.get(mood, []) %}
      <div class="mood-block">
        <div class="mood-block-head">
          <h3 class="mood-title">{{ mood }} <span class="count-badge">{{ list_for|length }}</span></h3>
          <a class="btn tiny ghost" href="{{ url_for('main.vault', mood=mood) }}">Open</a>
        </div>

        {% if list_for|length == 0 %}
          <div class="ghost-row small">
            <div class="ghost-art"></div>
            <div class="ghost-lines">
              <div class="ghost-line wide"></div>
              <div class="ghost-line"></div>
            </div>
          </div>
        {% else %}
          <ul class="song-list">
            {% for s in list_for %}
              <li class="song-item {% if highlight_id and highlight_id|int == s.id %}highlight{% endif %}"
                  data-preview-url="{{ s.preview_url or '' }}">
                <div class="song-left">
                  {% if s.artwork_url %}
                    <img class="song-art" src="{{ s.artwork_url }}" alt="Artwork">
                  {% else %}
                    <div class="art-placeholder tiny"></div>
                  {% endif %}
                </div>
                <div class="song-center">
                  <div class="song-title">{{ s.title }}</div>
                  {% if s.artist %}
                    <div class="song-artist">{{ s.artist }}</div>
                  {% endif %}
                  {% if s.note %}
                    <div class="song-note">{{ s.note }}</div>
                  {% endif %}
                </div>
                <div class="song-right">
                  {% if s.preview_url %}
                    <button class="btn tiny" type="button" data-audio-toggle>Play</button>
                  {% endif %}
                  <form class="inline-form" method="POST" action="{{ url_for('main.delete_song', song_id=s.id) }}">
                    <input type="hidden" name="next" value="{{ request.full_path }}">
                    <button class="btn tiny ghost danger" type="submit">Remove</button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endfor %}
  {% endif %}
</section>

{% endblock %}
