{% extends "base.html" %}
{% block content %}

<section class="card">
  <div class="vault-head">
    <div>
      <h2>Mood Map</h2>
      <div class="muted small">A quiet snapshot of your mood library.</div>
    </div>
    <div class="vault-head-actions">
      <a class="btn tiny ghost" href="{{ url_for('main.search') }}">Add a new vibe</a>
      <a class="btn tiny ghost" href="{{ url_for('main.vault') }}">Back to Vault</a>
    </div>
  </div>

  <div class="memory-recap">
    <div class="recap-box">
      <div class="recap-label">Total saves</div>
      <div class="recap-value">{{ total }}</div>
      <div class="recap-sub muted small">across all moods</div>
    </div>
    <div class="recap-box">
      <div class="recap-label">Your top mood</div>
      <div class="recap-value">{{ top_mood if top_mood else "â€”" }}</div>
      <div class="recap-sub muted small"></div>
    </div>
    <div class="recap-box recap-action">
      <div class="recap-label">Quick jump</div>
      {% if top_mood %}
        <a class="btn tiny primary" href="{{ url_for('main.vault', mood=top_mood) }}">Open it</a>
      {% else %}
        <a class="btn tiny ghost" href="{{ url_for('main.vault') }}">Open Vault</a>
      {% endif %}
      <div class="recap-sub muted small"></div>
    </div>
  </div>
</section>

<section class="mood-map-grid">
  {% for m in moods %}
    <div class="mood-map-card">
      <div class="mood-map-head">
        <span class="mini-mood">{{ m }}</span>
        <span class="mood-count">{{ counts[m] }}</span>
      </div>

      {% set last = latest_by_mood[m] %}
      {% if last %}
        <div class="mood-latest">
          <div class="mood-latest-art">
            {% if last.artwork_url %}
              <img src="{{ last.artwork_url |replace('100x100bb','600x600bb')|replace('100x100','600x600') }}" alt="Artwork">
            {% else %}
              <div class="art-placeholder tiny"></div>
            {% endif %}
          </div>
          <div class="mood-latest-text">
            <div class="song-title">{{ last.title }}</div>
            {% if last.artist %}
              <div class="song-artist">{{ last.artist }}</div>
            {% endif %}
          </div>
        </div>
      {% else %}
        <div class="ghost-row small">
          <div class="ghost-art"></div>
          <div class="ghost-lines">
            <div class="ghost-line wide"></div>
            <div class="ghost-line"></div>
          </div>
        </div>
      {% endif %}

      <div class="actions">
        <a class="btn tiny ghost" href="{{ url_for('main.vault', mood=m) }}">Open mood</a>
      </div>
    </div>
  {% endfor %}
</section>

{% endblock %}
